{"ast":null,"code":"// registrationSlice.js\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport axios from 'axios';\nexport const registerUser = createAsyncThunk('registration/registerUser', async ({\n  login,\n  password,\n  birthDate,\n  name,\n  email,\n  photo\n}) => {\n  const apiEndpointRegister = \"http://127.0.0.1:8000/api/user/register\";\n  const apiEndpointGet = \"http://127.0.0.1:8000/api/image/getPhotoPath\";\n  const apiEndpointUpload = \"http://127.0.0.1:8000/api/image/upload\";\n  try {\n    const formData = new FormData();\n    formData.append('photo_name', photo.name);\n    const getResponse = await axios.post(apiEndpointGet, formData);\n    let resultObject = getResponse.data;\n    let avatarPath = resultObject.photo_path;\n    formData.append('photo', photo);\n    const registerFormData = new FormData();\n    registerFormData.append('login', login);\n    registerFormData.append('password', password);\n    registerFormData.append('birth_date', birthDate);\n    registerFormData.append('name', name);\n    registerFormData.append('email', email);\n    registerFormData.append('avatar_path', avatarPath);\n    const registerResponse = await axios.post(apiEndpointRegister, registerFormData);\n    const userId = registerResponse.data.user.id;\n    formData.append('user_id', userId);\n    const uploadResponse = await axios.post(apiEndpointUpload, formData);\n    resultObject = uploadResponse.data;\n    avatarPath = resultObject.photo_path;\n    return userId;\n  } catch (error) {\n    throw new Error(error.response.data.message || error.message);\n  }\n});\nexport const uploadPhoto = createAsyncThunk('registration/uploadPhoto', async photo => {\n  const apiEndpointUpload = \"http://127.0.0.1:8000/api/image/upload\";\n  const formData = new FormData();\n  formData.append('photo', photo);\n  const response = await axios.post(apiEndpointUpload, formData);\n  return response.data;\n});\nexport const clearRegistrationStatus = () => dispatch => {\n  dispatch(registrationSlice.actions.clearError()); // Очистка только ошибки\n  dispatch(registrationSlice.actions.clearSuccess()); // Очистка только статуса успешной регистрации\n};\nconst registrationSlice = createSlice({\n  name: 'registration',\n  initialState: {\n    loading: false,\n    error: null,\n    success: false\n  },\n  reducers: {\n    clearError: state => {\n      state.error = null;\n    },\n    clearSuccess: state => {\n      state.success = false;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(registerUser.pending, state => {\n      state.loading = true;\n      state.error = null;\n      state.success = false;\n    }).addCase(registerUser.fulfilled, state => {\n      state.loading = false;\n      state.success = true;\n    }).addCase(registerUser.rejected, (state, action) => {\n      state.loading = false;\n      state.error = action.error.message;\n    });\n  }\n});\nexport const {\n  clearErrorAndSuccess\n} = registrationSlice.actions;\nexport default registrationSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","registerUser","login","password","birthDate","name","email","photo","apiEndpointRegister","apiEndpointGet","apiEndpointUpload","formData","FormData","append","getResponse","post","resultObject","data","avatarPath","photo_path","registerFormData","registerResponse","userId","user","id","uploadResponse","error","Error","response","message","uploadPhoto","clearRegistrationStatus","dispatch","registrationSlice","actions","clearError","clearSuccess","initialState","loading","success","reducers","state","extraReducers","builder","addCase","pending","fulfilled","rejected","action","clearErrorAndSuccess","reducer"],"sources":["C:/Users/Yakov/Documents/Programming/React JS/social-media-frontend/src/redux/RegistrationSlice.js"],"sourcesContent":["// registrationSlice.js\r\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\nexport const registerUser = createAsyncThunk(\r\n    'registration/registerUser',\r\n    async ({ login, password, birthDate, name, email, photo }) => {\r\n        const apiEndpointRegister = \"http://127.0.0.1:8000/api/user/register\";\r\n        const apiEndpointGet = \"http://127.0.0.1:8000/api/image/getPhotoPath\";\r\n        const apiEndpointUpload = \"http://127.0.0.1:8000/api/image/upload\";\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append('photo_name', photo.name);\r\n\r\n            const getResponse = await axios.post(apiEndpointGet, formData);\r\n            let resultObject = getResponse.data;\r\n            let avatarPath = resultObject.photo_path;\r\n\r\n            formData.append('photo', photo);\r\n\r\n            const registerFormData = new FormData();\r\n            registerFormData.append('login', login);\r\n            registerFormData.append('password', password);\r\n            registerFormData.append('birth_date', birthDate);\r\n            registerFormData.append('name', name);\r\n            registerFormData.append('email', email);\r\n            registerFormData.append('avatar_path', avatarPath);\r\n\r\n            const registerResponse = await axios.post(apiEndpointRegister, registerFormData);\r\n            const userId = registerResponse.data.user.id;\r\n\r\n            formData.append('user_id', userId);\r\n\r\n            const uploadResponse = await axios.post(apiEndpointUpload, formData);\r\n            resultObject = uploadResponse.data;\r\n            avatarPath = resultObject.photo_path;\r\n\r\n            return userId;\r\n        } catch (error) {\r\n            throw new Error(error.response.data.message || error.message);\r\n        }\r\n    }\r\n);\r\n\r\nexport const uploadPhoto = createAsyncThunk(\r\n    'registration/uploadPhoto',\r\n    async (photo) => {\r\n        const apiEndpointUpload = \"http://127.0.0.1:8000/api/image/upload\";\r\n        const formData = new FormData();\r\n        formData.append('photo', photo);\r\n        const response = await axios.post(apiEndpointUpload, formData);\r\n        return response.data;\r\n    }\r\n);\r\n\r\nexport const clearRegistrationStatus = () => (dispatch) => {\r\n    dispatch(registrationSlice.actions.clearError()); // Очистка только ошибки\r\n    dispatch(registrationSlice.actions.clearSuccess()); // Очистка только статуса успешной регистрации\r\n};\r\n\r\nconst registrationSlice = createSlice({\r\n    name: 'registration',\r\n    initialState: {\r\n        loading: false,\r\n        error: null,\r\n        success: false,\r\n    },\r\n    reducers: {\r\n        clearError: (state) => {\r\n            state.error = null;\r\n        },\r\n        clearSuccess: (state) => {\r\n            state.success = false;\r\n        },\r\n    },\r\n    extraReducers: (builder) => {\r\n        builder\r\n            .addCase(registerUser.pending, (state) => {\r\n                state.loading = true;\r\n                state.error = null;\r\n                state.success = false;\r\n            })\r\n            .addCase(registerUser.fulfilled, (state) => {\r\n                state.loading = false;\r\n                state.success = true;\r\n            })\r\n            .addCase(registerUser.rejected, (state, action) => {\r\n                state.loading = false;\r\n                state.error = action.error.message;\r\n            });\r\n    },\r\n});\r\n\r\nexport const { clearErrorAndSuccess } = registrationSlice.actions;\r\n\r\nexport default registrationSlice.reducer;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}